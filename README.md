# All-Included Deep Research

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≥–ª—É–±–æ–∫–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –ø–∞–º—è—Ç–∏, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∞—è –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ open-source –ø—Ä–æ–µ–∫—Ç–æ–≤.

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[QUICKSTART.md](QUICKSTART.md)** - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∑–∞ 5 –º–∏–Ω—É—Ç
- **[AGENT_LOGIC.md](AGENT_LOGIC.md)** - –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–Ω–æ–π –ª–æ–≥–∏–∫–∏ –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 4 –†–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã

- **Chat** - –ü—Ä–æ—Å—Ç–æ–π –¥–∏–∞–ª–æ–≥ —Å LLM –±–µ–∑ –≤–µ–±-–ø–æ–∏—Å–∫–∞
- **Web Search** (search) - –ë—ã—Å—Ç—Ä—ã–π –≤–µ–±-–ø–æ–∏—Å–∫ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–æ–≤ (2 –∏—Ç–µ—Ä–∞—Ü–∏–∏)
- **Deep Search** (deep_search) - –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–µ–±-–ø–æ–∏—Å–∫ —Å –≥–ª—É–±–æ–∫–∏–º–∏ –∏—Ç–µ—Ä–∞—Ü–∏—è–º–∏ (6 –∏—Ç–µ—Ä–∞—Ü–∏–π)
- **Deep Research** (deep_research) - –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ —Å—É–ø–µ—Ä–≤–∞–π–∑–µ—Ä–∞
  - –°—É–ø–µ—Ä–≤–∞–π–∑–µ—Ä (LangGraph —Å ReAct) –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç 1-5 –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤
  - –ö–∞–∂–¥—ã–π –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å - LangGraph –∞–≥–µ–Ω—Ç —Å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
  - –í—Å–µ –∞–≥–µ–Ω—Ç—ã –ø–∏—à—É—Ç –∑–∞–º–µ—Ç–∫–∏ –≤ markdown —Ñ–∞–π–ª—ã –≤ —Å–µ—Å—Å–∏–æ–Ω–Ω–æ–π –ø–∞–ø–∫–µ
  - –°—É–ø–µ—Ä–≤–∞–π–∑–µ—Ä –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –æ—á–µ—Ä–µ–¥–µ–π
  - –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –∏ —Å—Ç—Ä–∏–º–∏—Ç—Å—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
  - –ü–æ–¥—Ä–æ–±–Ω–µ–µ: [AGENT_LOGIC.md](AGENT_LOGIC.md)

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–∞–º—è—Ç–∏

- **–î–≤–æ–π–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**: –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–µ Markdown —Ñ–∞–π–ª—ã + PostgreSQL —Å pgvector
- **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫**: RRF (Reciprocal Rank Fusion) –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –∏ –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
- **–£–º–Ω–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ**: Markdown-aware chunking —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- **–ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —Ñ–∞–π–ª–∞–º–∏ –∏ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
  - –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø–∞–º—è—Ç–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `MEMORY_DIR` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `./memory_files`)
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç —á–∞—Ç–∞**: –ê–≥–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞ (`CHAT_HISTORY_LIMIT`)
- **–ê–≥–µ–Ω—Ç–Ω—ã–µ —Å–µ—Å—Å–∏–∏**: Deep Research —Å–æ–∑–¥–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞–ø–∫–∏ —Å–µ—Å—Å–∏–π —Å —Ñ–∞–π–ª–∞–º–∏ –ø–∞–º—è—Ç–∏ –∞–≥–µ–Ω—Ç–æ–≤
  - `main.md` - –≥–ª–∞–≤–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è (–∫–ª—é—á–µ–≤—ã–µ –∏–Ω—Å–∞–π—Ç—ã)
  - `draft_report.md` - —á–µ—Ä–Ω–æ–≤–∏–∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
  - `supervisor.md` - –ª–∏—á–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ —Å—É–ø–µ—Ä–≤–∞–π–∑–µ—Ä–∞
  - `agents/{agent_id}.md` - —Ñ–∞–π–ª—ã –∞–≥–µ–Ω—Ç–æ–≤ (todos –∏ –∑–∞–º–µ—Ç–∫–∏)
  - `items/` - –∑–∞–º–µ—Ç–∫–∏ –∞–≥–µ–Ω—Ç–æ–≤ —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

### ‚öôÔ∏è –ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

- **–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –ø–æ–∏—Å–∫–∞**: Tavily –∏–ª–∏ SearXNG (self-hosted)
- **–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤**: OpenAI, Ollama (–ª–æ–∫–∞–ª—å–Ω–æ), Cohere, –∏–ª–∏ HuggingFace
- **LLM –º–æ–¥–µ–ª–∏**: OpenAI GPT-4, Anthropic Claude, OpenRouter, –∏ –ª—é–±–æ–π OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API
- **–ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ**: –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ `.env` —Ñ–∞–π–ª—ã

### üõ† –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **Backend**: FastAPI + LangGraph workflows + Pydantic v2
- **Frontend**: Next.js 14 + React + TypeScript + Tailwind CSS
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL 16 + pgvector extension (–∏–ª–∏ SQLite –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- **Real-time**: SSE streaming –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ**: Docker Compose –¥–ª—è –ø—Ä–æ—Å—Ç–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–°–º. –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é: **[QUICKSTART.md](QUICKSTART.md)**

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Docker & Docker Compose** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) –ò–õ–ò
- Python 3.11+ –∏ Node.js 18+ –¥–ª—è —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- API –∫–ª—é—á–∏: OpenAI (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) –∏ Tavily (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### Option 1: Docker Compose (Recommended) ‚≠ê

```bash
# 1. Navigate to project directory
cd /root/asudakov/projects/all_included_deep_research

# 2. Configure backend environment
cd backend
cp .env.example .env
# Edit .env and add your API keys:
# - POSTGRES_PASSWORD (set a secure password)
# - OPENAI_API_KEY (required)
# - TAVILY_API_KEY or SEARCH_PROVIDER=searxng (choose one)
# - LLM_MODE=mock to run without external LLMs (for testing)
# - SEARCH_PROVIDER=mock to run without external search (for testing)
# - CHAT_HISTORY_LIMIT to control how many recent chat messages are injected

# 3. Configure Docker environment (project root)
cd ..
cp .env.example .env
# Edit .env and set POSTGRES_PASSWORD and MEMORY_HOST_PATH if needed

# 4. Start all services
docker compose up -d

# 5. Access the application
# Frontend: http://localhost:3000
# Backend API: http://localhost:8000
# API Docs: http://localhost:8000/docs

# 6. Stop services when done
docker compose down
```

**First-time setup takes 2-3 minutes** while Docker builds images and initializes the database.

**Note**: The Docker build process has been optimized - source code is now copied before package installation to ensure proper package setup.

### Option 2: Manual Setup (Development)

#### Prerequisites
- PostgreSQL 16 with pgvector extension installed
- Python 3.11+
- Node.js 18+

#### Backend Setup

```bash
cd backend

# Create virtual environment
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install dependencies
pip install -e .

# Configure environment
cp .env.example .env
# Edit .env with your settings:
# - Set POSTGRES_* variables to match your local PostgreSQL
# - Add OPENAI_API_KEY
# - Add TAVILY_API_KEY

# Run database migrations
alembic upgrade head

# Start the backend
python -m src
# Or with auto-reload: uvicorn src.api.app:app --reload
```

#### Frontend Setup

```bash
cd frontend

# Install dependencies
npm install

# Configure environment (optional)
# cp .env.local.example .env.local
# Default API URL is http://localhost:8000

# Start the frontend
npm run dev
```

#### Access the Application

- Frontend: http://localhost:3000
- Backend API: http://localhost:8000
- API Documentation: http://localhost:8000/docs

## üìñ –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[QUICKSTART.md](QUICKSTART.md)** - –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É
- **[AGENT_LOGIC.md](AGENT_LOGIC.md)** - –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤:
  - Chat Mode - –ø—Ä–æ—Å—Ç–æ–π –¥–∏–∞–ª–æ–≥
  - Web Search Mode - –±—ã—Å—Ç—Ä—ã–π –≤–µ–±-–ø–æ–∏—Å–∫
  - Deep Search Mode - –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–µ–±-–ø–æ–∏—Å–∫
  - Deep Research Mode - –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
all_included_deep_research/
‚îú‚îÄ‚îÄ backend/              # Python FastAPI + LangGraph
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/         # FastAPI endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ workflow/    # LangGraph workflows
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ memory/      # Memory system
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ search/      # Search providers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ embeddings/  # Embedding providers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ streaming/   # SSE streaming
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database/    # Database layer
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config/      # Configuration
‚îÇ   ‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îî‚îÄ‚îÄ pyproject.toml
‚îú‚îÄ‚îÄ frontend/            # Next.js + React + TypeScript
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/        # Next.js App Router
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/ # React components
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lib/        # API client, utilities
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ docker/              # Helper scripts
‚îî‚îÄ‚îÄ docker-compose.yml   # Full stack Compose
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### LangGraph Workflows

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç LangGraph –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ —Å–ª–æ–∂–Ω—ã—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:

```
User Query ‚Üí Deep Search (optional) ‚Üí Clarifying Questions (optional) ‚Üí
Analyze Query ‚Üí Plan Research ‚Üí Create Agent Characteristics ‚Üí
Execute Agents (parallel) ‚Üí Supervisor Reviews ‚Üí 
[Continue/Replan/Finish] ‚Üí
Compress Findings ‚Üí Generate Final Report ‚Üí Return
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –ª–æ–≥–∏–∫–µ —Ä–∞–±–æ—Ç—ã: **[AGENT_LOGIC.md](AGENT_LOGIC.md)**

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–∞–º—è—Ç–∏

- –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ –ø–∞–º—è—Ç–∏ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º
- –ù–∞—Ö–æ–¥–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–∞–º—è—Ç—å –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π + –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞) –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è

### Real-time Streaming

- OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π endpoint `/v1/chat/completions`
- SSE streaming —Å –±–ª–æ–∫–∞–º–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è/–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤/—Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π
- SessionManager –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º UI

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `backend/.env`:

```bash
# Database (required)
POSTGRES_PASSWORD=your_secure_password

# OpenAI (required for live LLM and embeddings)
OPENAI_API_KEY=sk-your-openai-api-key

# Tavily (required for web search)
TAVILY_API_KEY=tvly-your-tavily-api-key
```

### OpenAI-Compatible APIs (OpenRouter, 302.AI, etc.)

You can use any OpenAI-compatible API by setting the base URL:

```bash
# Use OpenRouter instead of OpenAI
OPENAI_BASE_URL=https://openrouter.ai/api/v1
OPENAI_API_KEY=sk-or-v1-your-openrouter-key

# Optional: Custom headers for OpenRouter
OPENAI_API_HTTP_REFERER=https://github.com/your-org/your-repo
OPENAI_API_X_TITLE=Your App Name

# Use any other OpenAI-compatible API
OPENAI_BASE_URL=https://api.302.ai/v1
OPENAI_API_KEY=your-api-key
```

**Note**: For OpenRouter, default headers are automatically added if not specified. For other APIs, you may need to set custom headers if required.

### Optional Settings

```bash
# Use Anthropic Claude instead of GPT
ANTHROPIC_API_KEY=sk-ant-your-key
RESEARCH_MODEL=anthropic:claude-3-5-sonnet-20241022

# Use OpenRouter or other OpenAI-compatible APIs
OPENAI_BASE_URL=https://openrouter.ai/api/v1
OPENAI_API_KEY=sk-or-v1-your-key
# Configure models to use OpenRouter models:
CHAT_MODEL=openai:gpt-4o-mini
RESEARCH_MODEL=openai:gpt-4o
# Or use other models available on OpenRouter:
# RESEARCH_MODEL=openai:qwen/qwen-2.5-72b-instruct
# RESEARCH_MODEL=openai:anthropic/claude-3.5-sonnet
# See https://openrouter.ai/models for all available models

# Use local Ollama for embeddings (free!)
# Start the container with: docker compose --profile local-embeddings up -d
EMBEDDING_PROVIDER=ollama
OLLAMA_BASE_URL=http://ollama:11434
OLLAMA_EMBEDDING_MODEL=nomic-embed-text

# Use local HuggingFace embeddings (no API key required)
EMBEDDING_PROVIDER=huggingface
HUGGINGFACE_MODEL=sentence-transformers/all-MiniLM-L6-v2
HUGGINGFACE_USE_LOCAL=true

# Offline testing without LLM/search
LLM_MODE=mock
SEARCH_PROVIDER=mock
EMBEDDING_PROVIDER=mock

# Use SearXNG instead of Tavily (self-hosted, free!)
SEARCH_PROVIDER=searxng
SEARXNG_INSTANCE_URL=http://localhost:8080

# Adjust research depth
BALANCED_MAX_ITERATIONS=10  # Default: 6
QUALITY_MAX_CONCURRENT=8    # Default: 5

# Include last N chat messages in prompts
CHAT_HISTORY_LIMIT=2

# Quality deep search tuning
DEEP_SEARCH_QUALITY_MAX_RESULTS=16
DEEP_SEARCH_QUALITY_QUERIES=6
DEEP_SEARCH_QUALITY_SCRAPE_TOP_N=8
DEEP_SEARCH_QUALITY_RERANK_TOP_K=12
DEEP_SEARCH_QUALITY_ITERATIONS=3
```

### Frontend Configuration

Edit `frontend/.env.local` (optional):

```bash
NEXT_PUBLIC_API_URL=http://localhost:8000
NEXT_PUBLIC_DEFAULT_MODE=search
```

## API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ backend, –ø–æ—Å–µ—Ç–∏—Ç–µ:
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

### –û—Å–Ω–æ–≤–Ω—ã–µ Endpoints

- `POST /v1/chat/completions` - OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π chat endpoint (model: `chat`, `search`/`web_search`, `deep_search`, `deep_research`)
- `POST /api/chat/stream` - Chat —Å —Å–æ–±—ã—Ç–∏—è–º–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (SSE)
- `POST /api/research` - –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é —Å–µ—Å—Å–∏—é
- `GET /api/memory` - –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –ø–∞–º—è—Ç–∏
- `POST /api/memory` - –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –ø–∞–º—è—Ç–∏
- `GET /api/config` - –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

Backend:
```bash
cd backend
pytest
```

Frontend:
```bash
cd frontend
npm test
```

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

Backend:
```bash
cd backend
ruff check .
ruff format .
mypy src
```

Frontend:
```bash
cd frontend
npm run lint
npm run type-check
```

## üéì –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –ª—É—á—à–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑ –≤–µ–¥—É—â–∏—Ö open-source –ø—Ä–æ–µ–∫—Ç–æ–≤:

| –ü—Ä–æ–µ–∫—Ç | –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å |
|--------|----------------------------|
| **multifile-markdown-mcp** | –ì–∏–±—Ä–∏–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–∞–º—è—Ç–∏ —Å RRF (Reciprocal Rank Fusion) –ø–æ–∏—Å–∫–æ–º |
| **open_deep_research** | –ü–∞—Ç—Ç–µ—Ä–Ω —Å—É–ø–µ—Ä–≤–∞–π–∑–µ—Ä–∞ —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è–º–∏ |
| **sgr-agent-core** | OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API —Å SSE streaming |
| **OpenDeepSearch** | –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –ø–æ–∏—Å–∫–∞ –∏ —Ä–µ—Ä–∞–Ω–∂–∏–Ω–≥ |
| **Perplexica** | –õ–∏–º–∏—Ç—ã –∏—Ç–µ—Ä–∞—Ü–∏–π –ø–æ —Ä–µ–∂–∏–º–∞–º –∏ streaming UI –±–ª–æ–∫–∏ |

## üìä –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤: **[AGENT_LOGIC.md](AGENT_LOGIC.md)**

### –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å

```
User Query ‚Üí Deep Search (optional) ‚Üí Clarifying Questions (optional) ‚Üí
Analyze Query ‚Üí Plan Research ‚Üí Create Agent Characteristics ‚Üí
Execute Agents (parallel) ‚Üí Supervisor Reviews ‚Üí 
[Continue/Replan/Finish] ‚Üí
Compress Findings ‚Üí Generate Final Report ‚Üí Return
```

### –°–∏—Å—Ç–µ–º–∞ –ø–∞–º—è—Ç–∏

1. **Markdown —Ñ–∞–π–ª—ã**: –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∑–∞–º–µ—Ç–∫–∏ (—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `MEMORY_DIR`)
2. **–í–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL + pgvector –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
3. **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫**: –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ + –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ —Å RRF
4. **–ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–∞—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–æ–±–ª–µ–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ GitHub issue tracker.
