[uwsgi]
# Who will run the code
uid = searxng
gid = searxng

# Number of workers (usually CPU count)
# Reduced to avoid SQLite database locking issues during initialization
# SQLite doesn't handle concurrent initialization well
workers = 2

# Number of threads per worker
# Increased for high load (I/O-bound tasks benefit from more threads)
threads = 8

# The right granted on the created socket
chmod-socket = 666

# Plugin to use and interpreter config
single-interpreter = true
master = true
plugin = python3
lazy-apps = true
enable-threads = true
# Delay app loading to avoid SQLite locking during initialization
lazy = true

# Module to import
module = searx.webapp

# Virtualenv and python path
virtualenv = /usr/local/searxng/searx-pyenv
pythonpath = /usr/local/searxng/searxng-src
chdir = /usr/local/searxng/searxng-src/searx

# automatically set processes name to something meaningful
auto-procname = true

# Disable request logging for privacy
disable-logging = true
log-5xx = true

# Set the max size of a request (request-body excluded)
# Increased for larger requests under high load
buffer-size = 16384

# No keep alive
# See https://github.com/searx/searx-docker/issues/24
add-header = Connection: close

# uwsgi serves the static files
static-map = /static=/usr/local/searxng/searxng-src/searx/static
# expires set to one day
static-expires = /* 86400
static-gzip-all = True
offload-threads = 8

# Performance optimizations for high load
harakiri = 120  # Kill workers after 120 seconds of inactivity
max-requests = 1000  # Restart workers after 1000 requests (prevents memory leaks)
reload-mercy = 10
worker-reload-mercy = 10
